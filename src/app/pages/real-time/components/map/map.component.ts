import { ChangeDetectionStrategy, Component, OnInit } from '@angular/core';
import { LeafletModule } from '@asymmetrik/ngx-leaflet';
import { RealTimeService } from '../../../../services/realtime/realtime.service';

import * as L from 'leaflet';

import { GoogleMap } from '@angular/google-maps';

L.Icon.Default.imagePath = 'assets/icons/map/'
@Component({
  selector: 'app-map',
  standalone: true,
  imports: [GoogleMap,LeafletModule],
  templateUrl: './map.component.html',
  styleUrl: './map.component.scss',
  changeDetection: ChangeDetectionStrategy.OnPush
})

export class MapComponent implements OnInit {
  private map!: L.Map;
  options!:{};
  sid!:"";
/*   vehiclePosition=[
    {
       "nm":"FM1000-1",
       "cls":2,
       "id":27887883,
       "mu":0,
       "pos":{
          "t":1708592173,
          "f":3,
          "lc":0,
          "y":4.0226731,
          "x":9.7030975,
          "c":0,
          "z":0,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708592173,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.0226731,
             "x":9.7030975,
             "c":0,
             "z":0,
             "s":0,
             "sc":0
          },
          "i":1,
          "lc":0,
          "rt":1708592175,
          "p":{
             "param240":1,
             "param80":0,
             "gsm":2,
             "param181":39,
             "param182":19,
             "hdop":1.9,
             "pwr_ext":15.707,
             "param24":0,
             "param205":1742,
             "param206":20008,
             "pwr_int":4.016,
             "param68":0,
             "param199":0,
             "param241":62402,
             "param16":76,
             "battery_charge":1
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-2",
       "cls":2,
       "id":27889700,
       "mu":0,
       "pos":{
          "t":1708591959,
          "f":3,
          "lc":0,
          "y":4.0209153,
          "x":9.7022695,
          "c":0,
          "z":0,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708591959,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.0209153,
             "x":9.7022695,
             "c":0,
             "z":0,
             "s":0,
             "sc":0
          },
          "i":0,
          "lc":0,
          "rt":1708591975,
          "p":{
             "param240":0,
             "param80":0,
             "gsm":2,
             "param181":236,
             "param182":39,
             "hdop":3.9,
             "pwr_ext":15.665,
             "param24":0,
             "param205":31652,
             "param206":801,
             "pwr_int":0.012,
             "param68":0,
             "param199":0,
             "param241":62401,
             "param16":117,
             "battery_charge":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-3",
       "cls":2,
       "id":27889748,
       "mu":0,
       "pos":{
          "t":1708586828,
          "f":3,
          "lc":0,
          "y":4.022678,
          "x":9.7030833,
          "c":0,
          "z":0,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708586828,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.022678,
             "x":9.7030833,
             "c":0,
             "z":0,
             "s":0,
             "sc":0
          },
          "i":1,
          "lc":0,
          "rt":1708586965,
          "p":{
             "param240":1,
             "param80":5,
             "gsm":3,
             "param181":16,
             "param182":7,
             "hdop":0.7,
             "pwr_ext":0.092,
             "param24":0,
             "param205":31652,
             "param206":801,
             "pwr_int":2.769,
             "param68":0,
             "param199":14,
             "param241":62401,
             "param16":0,
             "battery_charge":1
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-4",
       "cls":2,
       "id":27889884,
       "mu":0,
       "pos":{
          "t":1708586883,
          "f":3,
          "lc":0,
          "y":4.0226175,
          "x":9.7028883,
          "c":0,
          "z":38,
          "s":0,
          "sc":7
       },
       "lmsg":{
          "t":1708586883,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.0226175,
             "x":9.7028883,
             "c":0,
             "z":38,
             "s":0,
             "sc":7
          },
          "i":1,
          "lc":0,
          "rt":1708586886,
          "p":{
             "param240":1,
             "param80":1,
             "gsm":2,
             "param181":27,
             "param182":12,
             "hdop":1.2,
             "pwr_ext":15.67,
             "param24":0,
             "param205":22802,
             "param206":20008,
             "pwr_int":1.713,
             "param68":0,
             "param199":0,
             "param241":62402,
             "param16":36,
             "battery_charge":1
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-5",
       "cls":2,
       "id":27890049,
       "mu":0,
       "pos":{
          "t":1708605863,
          "f":3,
          "lc":0,
          "y":4.0225781,
          "x":9.7031805,
          "c":26,
          "z":31,
          "s":0,
          "sc":16
       },
       "lmsg":{
          "t":1708605863,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.0225781,
             "x":9.7031805,
             "c":26,
             "z":31,
             "s":0,
             "sc":16
          },
          "i":1,
          "lc":0,
          "rt":1708605874,
          "p":{
             "param240":1,
             "param80":1,
             "gsm":4,
             "param181":12,
             "param182":6,
             "hdop":0.6,
             "pwr_ext":12.041,
             "param24":0,
             "param205":12733,
             "param206":801,
             "pwr_int":0.04,
             "param68":0,
             "param199":0,
             "param241":62401,
             "param16":52,
             "battery_charge":1
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-6",
       "cls":2,
       "id":27890114,
       "mu":0,
       "pos":{
          "t":1708592887,
          "f":3,
          "lc":0,
          "y":4.0226846,
          "x":9.7028845,
          "c":0,
          "z":0,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708592887,
          "f":3,
          "tp":"ud",
          "pos":{
             "y":4.0226846,
             "x":9.7028845,
             "c":0,
             "z":0,
             "s":0,
             "sc":0
          },
          "i":0,
          "lc":0,
          "rt":1708592909,
          "p":{
             "param240":0,
             "param80":0,
             "gsm":3,
             "param181":87,
             "param182":33,
             "hdop":3.3,
             "pwr_ext":0.092,
             "param24":0,
             "param205":31652,
             "param206":801,
             "pwr_int":3.514,
             "param68":0,
             "param199":0,
             "param241":62401,
             "param16":0,
             "battery_charge":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"FM1000-7",
       "cls":2,
       "id":27892122,
       "mu":0,
       "pos":null,
       "lmsg":null,
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 1",
       "cls":2,
       "id":27834497,
       "mu":0,
       "pos":{
          "t":1708601000,
          "f":1,
          "lc":376759296,
          "y":4.030908,
          "x":9.70329,
          "c":63,
          "z":-6.2,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708601078,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708601079,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 2",
       "cls":2,
       "id":27866892,
       "mu":0,
       "pos":{
          "t":1708603453,
          "f":1,
          "lc":28226705,
          "y":4.030549,
          "x":9.702771,
          "c":230,
          "z":11,
          "s":3,
          "sc":255
       },
       "lmsg":{
          "t":1708603464,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708603468,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 3-paul jing",
       "cls":2,
       "id":27867056,
       "mu":0,
       "pos":{
          "t":1708606981,
          "f":1,
          "lc":3180191385,
          "y":4.032121,
          "x":9.695176,
          "c":356,
          "z":20.5,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606981,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.032121,
             "x":9.695176,
             "c":356,
             "z":20.5,
             "s":0,
             "sc":255
          },
          "lc":3180191385,
          "rt":1708606992,
          "p":{
             "gps_acc":1,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"FRI",
             "fri":1,
             "dev_type":39,
             "proto_ver":4354,
             "pwr_ext":13.468,
             "report_id":1,
             "report_type":0,
             "mileage":18.4,
             "adc1":0.033,
             "adc2":0.24,
             "backup_battery":99,
             "state":"220000",
             "motion_status":34,
             "ign":1,
             "din_status":0,
             "dout_status":0,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":86459
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 4",
       "cls":2,
       "id":27867145,
       "mu":0,
       "pos":{
          "t":1708603891,
          "f":1,
          "lc":28358208,
          "y":4.028358,
          "x":9.697869,
          "c":307,
          "z":23.8,
          "s":20,
          "sc":255
       },
       "lmsg":{
          "t":1708603905,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708603908,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 5",
       "cls":2,
       "id":27867199,
       "mu":0,
       "pos":{
          "t":1708097048,
          "f":1,
          "lc":856933433,
          "y":4.022602,
          "x":9.702937,
          "c":73,
          "z":13.9,
          "s":18,
          "sc":0
       },
       "lmsg":{
          "t":1708528735,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708528737,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":0.6
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 6",
       "cls":2,
       "id":27869122,
       "mu":0,
       "pos":{
          "t":1708605897,
          "f":1,
          "lc":686427945,
          "y":4.047506,
          "x":9.695398,
          "c":291,
          "z":20,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606087,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606088,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 7",
       "cls":2,
       "id":27869226,
       "mu":0,
       "pos":{
          "t":1707991074,
          "f":3,
          "lc":1602293329,
          "y":4.022508,
          "x":9.702828,
          "c":182,
          "z":45.6,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708529647,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708529648,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"MPF",
             "mpf":1,
             "dev_type":39,
             "proto_ver":4354,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":78266
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 8",
       "cls":2,
       "id":27870585,
       "mu":0,
       "pos":{
          "t":1708097956,
          "f":1,
          "lc":1882747428,
          "y":4.022773,
          "x":9.70297,
          "c":83,
          "z":1.3,
          "s":4,
          "sc":0
       },
       "lmsg":{
          "t":1708532234,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708532236,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":0.2
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 9",
       "cls":2,
       "id":27869753,
       "mu":0,
       "pos":{
          "t":1708606987,
          "f":1,
          "lc":1831695233,
          "y":4.022685,
          "x":9.702974,
          "c":242,
          "z":-6.3,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606987,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.022685,
             "x":9.702974,
             "c":242,
             "z":-6.3,
             "s":0,
             "sc":255
          },
          "lc":1831695233,
          "rt":1708606997,
          "p":{
             "gps_acc":2,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":77.7,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":78273
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 10",
       "cls":2,
       "id":27869851,
       "mu":0,
       "pos":{
          "t":1708599976,
          "f":1,
          "lc":1831069065,
          "y":4.022693,
          "x":9.702931,
          "c":73,
          "z":30.7,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708599998,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708600001,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 11",
       "cls":2,
       "id":27870518,
       "mu":0,
       "pos":{
          "t":1708602594,
          "f":1,
          "lc":1831069065,
          "y":4.021863,
          "x":9.702521,
          "c":186,
          "z":74.3,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708602609,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708602610,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 12",
       "cls":2,
       "id":27870635,
       "mu":0,
       "pos":{
          "t":1708606960,
          "f":1,
          "lc":1831695233,
          "y":4.022747,
          "x":9.702751,
          "c":117,
          "z":-80.6,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606960,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.022747,
             "x":9.702751,
             "c":117,
             "z":-80.6,
             "s":0,
             "sc":255
          },
          "lc":1831695233,
          "rt":1708606970,
          "p":{
             "gps_acc":4,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"FRI",
             "fri":1,
             "dev_type":39,
             "proto_ver":4354,
             "pwr_ext":15.815,
             "report_id":1,
             "report_type":0,
             "mileage":6.2,
             "adc1":0.023,
             "adc2":0.252,
             "backup_battery":17,
             "state":"110000",
             "motion_status":17,
             "ign":0,
             "din_status":0,
             "dout_status":0,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":78273
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 13",
       "cls":2,
       "id":27870718,
       "mu":0,
       "pos":{
          "t":1708606793,
          "f":1,
          "lc":856933433,
          "y":4.022638,
          "x":9.702981,
          "c":0,
          "z":29,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606897,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606898,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"8923700075338311236F",
             "csq_rssi":16,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.774,
             "pwr_int":4.06,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.025,
             "adc2":0.238,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 14",
       "cls":2,
       "id":27870764,
       "mu":0,
       "pos":{
          "t":1708511218,
          "f":5,
          "lc":1946821184,
          "y":4.022671,
          "x":9.70304,
          "c":0,
          "z":30.4,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708511492,
          "f":4,
          "tp":"ud",
          "pos":null,
          "o":2,
          "lc":0,
          "rt":1708511493,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"89237022304280613995",
             "csq_rssi":11,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.643,
             "pwr_int":3.82,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.076,
             "adc2":0.238,
             "din_status":0,
             "dout_status":2,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 15",
       "cls":2,
       "id":27870823,
       "mu":0,
       "pos":{
          "t":1708606558,
          "f":1,
          "lc":1831069065,
          "y":4.022633,
          "x":9.702941,
          "c":0,
          "z":29.3,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606786,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606787,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"8923700075336541644F",
             "csq_rssi":17,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.652,
             "pwr_int":3.65,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0,
             "adc2":0.259,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 16",
       "cls":2,
       "id":27870870,
       "mu":0,
       "pos":{
          "t":1708606636,
          "f":1,
          "lc":1882747428,
          "y":4.022233,
          "x":9.703726,
          "c":118,
          "z":107.8,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606922,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606922,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"89237021905180039379",
             "csq_rssi":14,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.783,
             "pwr_int":3.65,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.016,
             "adc2":0.241,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 17",
       "cls":2,
       "id":27870929,
       "mu":0,
       "pos":{
          "t":1708606794,
          "f":1,
          "lc":855572752,
          "y":4.022722,
          "x":9.70286,
          "c":0,
          "z":15.6,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606904,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606904,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"8923700075342412004F",
             "csq_rssi":15,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.709,
             "pwr_int":3.67,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.075,
             "adc2":0.264,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 18",
       "cls":2,
       "id":27870962,
       "mu":0,
       "pos":{
          "t":1708606945,
          "f":1,
          "lc":1831695233,
          "y":4.022638,
          "x":9.70295,
          "c":0,
          "z":37.7,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606945,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.022638,
             "x":9.70295,
             "c":0,
             "z":37.7,
             "s":0,
             "sc":255
          },
          "lc":1831695233,
          "rt":1708606956,
          "p":{
             "gps_acc":2,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"FRI",
             "fri":1,
             "dev_type":39,
             "proto_ver":4354,
             "pwr_ext":15.727,
             "report_id":1,
             "report_type":0,
             "mileage":4.3,
             "adc1":0.009,
             "adc2":0.247,
             "backup_battery":60,
             "state":"110000",
             "motion_status":17,
             "ign":0,
             "din_status":0,
             "dout_status":0,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":78273
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 19",
       "cls":2,
       "id":27872888,
       "mu":0,
       "pos":{
          "t":1708507208,
          "f":1,
          "lc":856933433,
          "y":4.02255,
          "x":9.702914,
          "c":0,
          "z":6,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708507289,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708507290,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"8923700075342417060F",
             "csq_rssi":18,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":15.493,
             "pwr_int":3.82,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.047,
             "adc2":0.236,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 20 - junior épée",
       "cls":2,
       "id":27870999,
       "mu":0,
       "pos":{
          "t":1708606979,
          "f":1,
          "lc":1205331600,
          "y":4.030465,
          "x":9.69338,
          "c":0,
          "z":18.8,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606979,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.030465,
             "x":9.69338,
             "c":0,
             "z":18.8,
             "s":0,
             "sc":255
          },
          "lc":1205331600,
          "rt":1708606990,
          "p":{
             "gps_acc":2,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"FRI",
             "fri":1,
             "dev_type":39,
             "proto_ver":4354,
             "pwr_ext":12.156,
             "report_id":1,
             "report_type":0,
             "mileage":0,
             "adc1":0.104,
             "adc2":0.186,
             "backup_battery":10,
             "state":"110000",
             "motion_status":17,
             "ign":0,
             "din_status":0,
             "dout_status":0,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":74164
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 21",
       "cls":2,
       "id":27873807,
       "mu":0,
       "pos":{
          "t":1708606967,
          "f":1,
          "lc":609513728,
          "y":4.023766,
          "x":9.695277,
          "c":304,
          "z":25.1,
          "s":4,
          "sc":255
       },
       "lmsg":{
          "t":1708606967,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.023766,
             "x":9.695277,
             "c":304,
             "z":25.1,
             "s":4,
             "sc":255
          },
          "lc":609513728,
          "rt":1708606976,
          "p":{
             "gps_acc":1,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":0,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":70032
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 22",
       "cls":2,
       "id":27874428,
       "mu":0,
       "pos":{
          "t":1708518763,
          "f":1,
          "lc":1831069065,
          "y":4.022665,
          "x":9.703177,
          "c":124,
          "z":21.4,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708518786,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708518787,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PFA",
             "pfa":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 23 - timbawa",
       "cls":2,
       "id":27874493,
       "mu":0,
       "pos":{
          "t":1708606901,
          "f":1,
          "lc":700412388,
          "y":4.025403,
          "x":9.691207,
          "c":181,
          "z":25.5,
          "s":0,
          "sc":255
       },
       "lmsg":{
          "t":1708606915,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708606917,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"INF",
             "inf":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":11,
             "iccid":"8923700071198750951F",
             "csq_rssi":19,
             "csq_ber":0,
             "bat_status":1,
             "pwr_ext":12.158,
             "pwr_int":3.81,
             "charging":0,
             "led_on":1,
             "pwr_saving_mode":0,
             "ext_gnss_antenna":1,
             "pin15_mode":0,
             "adc1":0.173,
             "adc2":0.195,
             "din_status":0,
             "dout_status":0,
             "time_zone":0,
             "daylight_saving":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 24",
       "cls":2,
       "id":27874672,
       "mu":0,
       "pos":{
          "t":1708361692,
          "f":1,
          "lc":1882747428,
          "y":4.022685,
          "x":9.702924,
          "c":0,
          "z":25.3,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708533960,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708533961,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 25",
       "cls":2,
       "id":27874756,
       "mu":0,
       "pos":{
          "t":1708587245,
          "f":1,
          "lc":856933433,
          "y":4.022657,
          "x":9.702884,
          "c":0,
          "z":4.4,
          "s":13,
          "sc":0
       },
       "lmsg":{
          "t":1708587314,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708587314,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"TOW",
             "tow":1,
             "dev_type":39,
             "proto_ver":4354,
             "report_id":0,
             "report_type":0,
             "mileage":0.5
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 26",
       "cls":2,
       "id":27874815,
       "mu":0,
       "pos":{
          "t":1708356434,
          "f":1,
          "lc":856350272,
          "y":4.022657,
          "x":9.702692,
          "c":0,
          "z":-22,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708605884,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708605892,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"PDP",
             "pdp":1,
             "dev_type":39,
             "proto_ver":4354
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 27",
       "cls":2,
       "id":27879445,
       "mu":0,
       "pos":{
          "t":1708336131,
          "f":1,
          "lc":855572752,
          "y":4.022704,
          "x":9.703022,
          "c":0,
          "z":27.4,
          "s":1,
          "sc":0
       },
       "lmsg":{
          "t":1708336131,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.022704,
             "x":9.703022,
             "c":0,
             "z":27.4,
             "s":1,
             "sc":0
          },
          "lc":855572752,
          "rt":1708336131,
          "p":{
             "gps_acc":0,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"ANT",
             "ant":1,
             "dev_type":39,
             "proto_ver":4354,
             "ext_gps_ant":1,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":97188
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 28",
       "cls":2,
       "id":27879764,
       "mu":0,
       "pos":{
          "t":1708413840,
          "f":1,
          "lc":1882747428,
          "y":4.02231,
          "x":9.703123,
          "c":109,
          "z":28.8,
          "s":4,
          "sc":0
       },
       "lmsg":{
          "t":1708427970,
          "f":0,
          "tp":"ud",
          "pos":null,
          "lc":0,
          "rt":1708427971,
          "p":{
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"STT",
             "stt":1,
             "dev_type":39,
             "proto_ver":4354,
             "motion_status":22,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":97192
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 29",
       "cls":2,
       "id":27879937,
       "mu":0,
       "pos":{
          "t":1708352479,
          "f":1,
          "lc":855572752,
          "y":4.02259,
          "x":9.702835,
          "c":79,
          "z":-1.6,
          "s":0,
          "sc":0
       },
       "lmsg":{
          "t":1708352479,
          "f":1,
          "tp":"ud",
          "pos":{
             "y":4.02259,
             "x":9.702835,
             "c":79,
             "z":-1.6,
             "s":0,
             "sc":0
          },
          "lc":855572752,
          "rt":1708352479,
          "p":{
             "gps_acc":0,
             "report":"RESP",
             "buffer":0,
             "msg_type_name":"ANT",
             "ant":1,
             "dev_type":39,
             "proto_ver":4354,
             "ext_gps_ant":1,
             "mcc":624,
             "mnc":1,
             "lac":1,
             "cell_id":97188
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    },
    {
       "nm":"pilote 30",
       "cls":2,
       "id":27881079,
       "mu":0,
       "pos":{
          "t":1708360848,
          "f":1,
          "lc":855572752,
          "y":4.022682,
          "x":9.70295,
          "c":0,
          "z":17.4,
          "s":50,
          "sc":0
       },
       "lmsg":{
          "t":1708422378,
          "f":2,
          "tp":"ud",
          "pos":null,
          "i":1,
          "lc":0,
          "rt":1708422460,
          "p":{
             "report":"BUFF",
             "buffer":1,
             "msg_type_name":"FRI",
             "fri":1,
             "dev_type":39,
             "proto_ver":4354,
             "pwr_ext":15.709,
             "report_id":1,
             "report_type":0,
             "mileage":0,
             "adc1":0,
             "adc2":0.25,
             "backup_battery":56,
             "state":"210100",
             "motion_status":33,
             "ign":1,
             "din_status":1,
             "dout_status":0
          }
       },
       "act":1,
       "dactt":0,
       "vp":null,
       "retr":null,
       "uacl":19327369763
    }
 ] */
  vehiclePosition!:[]

  ngOnInit(): void {
    this.initMap()
   // this.onUpdateMakers()
 /*    setInterval(()=>this.onUpdatePosition(),10000) */
   } 
      
  constructor(private realTimeService:RealTimeService){}

  onUpdatePosition(){
    this.onGetSid();
    this.onGetVehiclePosition(this.sid);
    this.onUpdateMakers();
  }

  onGetSid(){
    this.realTimeService.getSessionId()
    .then(res=>{
      this.sid=res.data.eid
    })
    .catch(err => console.log(err))
    .finally(()=>console.log(this.sid))
  }
  
  onGetVehiclePosition(param:string){
    this.realTimeService.getVehiclePosition(param)
    .then(res=>{
      this.vehiclePosition=res.data.items
    })
    .catch(err => console.log(err))
    .finally(()=>console.log(this.vehiclePosition))
  }

  onAddMarkers(Y:number,X:number,vehicule:string) {
    L.marker([Y, X]).addTo(this.map).bindPopup("<p>Vehicule</p><b>"+" "+ vehicule + "</b>").openPopup()
  }

  onUpdateMakers(){
    this.vehiclePosition.map((item)=>{
      this.onAddMarkers((item as any).pos?.y,(item as any).pos?.x,(item as any).nm);
    })
  }

  onMapReady($event: L.Map) {
    this.map = $event;
    //this.onUpdatePosition();
    this.onUpdateMakers()
  }

  
 private initMap():void{
  this.options = {
    layers: [
      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '&copy; <a href="https://camtrack.net/">Camtrack</a>'
      })
    ],
   
    center: { lat: 4.0482700, lng: 9.7042800 }
  }
}
 
 

}
